<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Basket</title>

<style>
:root{
  --bg:#efeae2;
  --card:#ffffff;
  --border:#e5e5e5;
  --primary:#000;
  --muted:#6b6b6b;
  --radius:14px;
}

*{box-sizing:border-box}

body{
  font-family: Inter, Arial, sans-serif;
  background:var(--bg);
  margin:0;
  height:100vh;
  display:flex;
}

/* ---------------- SIDEBAR (SUPPLIERS) ---------------- */
.sidebar{
  width:280px;
  background:#fff;
  border-right:1px solid var(--border);
  overflow-y:auto;
}

.sidebar h3{
  margin:0;
  padding:16px;
  font-size:16px;
  border-bottom:1px solid var(--border);
}

.supplier-item{
  padding:14px 16px;
  cursor:pointer;
  font-size:14px;
}

.supplier-item:hover,
.supplier-item.active{
  background:#f4f4f4;
}

/* ---------------- MAIN ---------------- */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
}

/* HEADER */
header{
  background:#fff;
  padding:12px 18px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header a{
  font-size:13px;
  color:#000;
  text-decoration:none;
}

/* CONTENT */
#content{
  flex:1;
  overflow-y:auto;
}

.content-inner{
  max-width:420px;
  margin:0 auto;
  padding:18px 12px;
}

/* NOTICE */
.notice{
  background:#fff6d6;
  border:1px solid #f2d98b;
  padding:12px;
  border-radius:10px;
  font-size:13px;
  margin-bottom:14px;
}

/* ITEM CARD */
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:12px;
  margin-bottom:14px;
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
}

.card b{
  font-size:14px;
}

.card small{
  display:block;
  font-size:12px;
  color:#555;
  margin-top:4px;
}

/* TOTAL */
.summary{
  background:#fff;
  border-radius:var(--radius);
  padding:14px;
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
  margin-top:16px;
}

.total{
  font-size:17px;
  font-weight:600;
  text-align:right;
}

/* EMPTY */
.empty{
  text-align:center;
  color:#777;
  padding:40px 0;
  font-size:14px;
}
</style>
</head>

<body>

<!-- ---------------- SIDEBAR ---------------- -->
<div class="sidebar">
  <h3>My Baskets</h3>
  <div id="supplierList"></div>
</div>

<!-- ---------------- MAIN ---------------- -->
<div class="main">

<header>
  <b id="title">Select a Supplier</b>
  <a href="buyer-feed_v5.html">← Back to Feed</a>
</header>

<div id="content">
  <div class="content-inner">
    <div id="notice" class="notice" style="display:none;"></div>
    <div id="basket">Select a supplier to view basket</div>
  </div>
</div>

</div>

<script>
/* BACKEND: Wholesale_Backend_v2 */
const API="https://script.google.com/macros/s/AKfycbw6Mc4ay2_69EzczKSkigCMxuWFlJ4P986cpuOw9P0rnvsoSeOONWCKRrEphio2513v/exec";
const BUYER_ID="BUY001";

/* Supplier list (same as buyer feed) */
const suppliers=[
  {id:"SUP001",name:"MN Fashions Buyer Club A"},
  {id:"SUP002",name:"AURA Jaipur"},
  {id:"SUP003",name:"Dolly Ethnic Wear"}
];

const supplierList=document.getElementById("supplierList");
const basketDiv=document.getElementById("basket");
const notice=document.getElementById("notice");
const title=document.getElementById("title");

/* Render suppliers */
suppliers.forEach(s=>{
  const d=document.createElement("div");
  d.className="supplier-item";
  d.innerText=s.name;
  d.onclick=()=>selectSupplier(s,d);
  supplierList.appendChild(d);
});

function selectSupplier(s,el){
  document.querySelectorAll(".supplier-item").forEach(i=>i.classList.remove("active"));
  el.classList.add("active");
  title.innerText=s.name;
  loadBasket(s.id);
}

function loadBasket(supplierId){
  basketDiv.innerHTML="Loading basket…";
  notice.style.display="none";

  fetch(`${API}?action=getSupplierBaskets&supplierId=${supplierId}`)
    .then(r=>r.json())
    .then(j=>{
      const baskets=j.data||[];
      const basket=baskets.find(b=>b.buyerId===BUYER_ID);

      if(!basket || basket.items.length===0){
        basketDiv.innerHTML="<div class='empty'>Basket is empty for this supplier.</div>";
        return;
      }

      renderBasket(basket);
    });
}

function renderBasket(b){
  let html="";
  let grandTotal=0;

  b.items.forEach(i=>{
    const amount=i.pcs*i.pricePerPC;
    const gstAmt=amount*i.gstPercent/100;
    const total=amount+gstAmt;

    grandTotal+=total;

    html+=`
      <div class="card">
        <b>${i.productName}</b>
        <small>Sets: ${i.sets} · Pcs: ${i.pcs}</small>
        <small>Rate: ₹${i.pricePerPC} + ${i.gstPercent}% GST</small>
        <small><b>Item Total:</b> ₹${total.toFixed(2)}</small>
      </div>
    `;
  });

  html+=`
    <div class="summary">
      <div class="total">Grand Total: ₹${grandTotal.toFixed(2)}</div>
    </div>
  `;

  basketDiv.innerHTML=html;

  notice.style.display="block";
  notice.innerText="Basket sent to supplier for review. Stock will be locked once approved.";
}
</script>

</body>
</html>
